TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER deleting_theme\n	BEFORE DELETE\n	ON temi\n	FOR EACH ROW\nBEGIN\nSET @DISABLE_TRIGGER = 1;\n  -- Удаляем ошибки, связанные с вопросами тестов удаляемой темы\n  DELETE osh\n    FROM mathematical_analysis.oshibki osh\n      INNER JOIN mathematical_analysis.voprosi vp\n        ON osh.id_vopr = vp.id_vopr\n      INNER JOIN mathematical_analysis.voprosi_testov vt\n        ON vp.id_vopr = vt.id_vopr\n      INNER JOIN mathematical_analysis.tests tst\n        ON vt.id_tests = tst.id_test\n  WHERE tst.id_temi = OLD.id_temi;\n\n  -- Удаляем ошибки, связанные с попытками тестов удаляемой темы\n  DELETE osh\n    FROM mathematical_analysis.oshibki osh\n      INNER JOIN mathematical_analysis.popitki pop\n        ON osh.id_popitka = pop.id_popitka\n      INNER JOIN mathematical_analysis.tests tst\n        ON pop.id_tests = tst.id_test\n  WHERE tst.id_temi = OLD.id_temi;\n\n  -- Далее удаляем попытки, ошибки из которых были удалены выше\n  DELETE\n    FROM mathematical_analysis.popitki\n  WHERE id_tests IN (SELECT\n        id_test\n      FROM mathematical_analysis.tests\n      WHERE id_temi = OLD.id_temi);\n\n  -- Удаляем записи из таблицы \'otveti\', связанные с вопросами\n  DELETE ot\n    FROM mathematical_analysis.otveti ot\n      INNER JOIN mathematical_analysis.voprosi vp\n        ON ot.id_vopr = vp.id_vopr\n      INNER JOIN mathematical_analysis.voprosi_testov vt\n        ON vp.id_vopr = vt.id_vopr\n      INNER JOIN mathematical_analysis.tests ts\n        ON vt.id_tests = ts.id_test\n  WHERE ts.id_temi = OLD.id_temi;\n\n  -- Удаляем связи между тестами и вопросами\n  DELETE vt\n    FROM mathematical_analysis.voprosi_testov vt\n      INNER JOIN mathematical_analysis.tests ts\n        ON vt.id_tests = ts.id_test\n  WHERE ts.id_temi = OLD.id_temi;\n\n  -- Удаляем вопросы, связанные с тестами\n  DELETE vp\n    FROM mathematical_analysis.voprosi vp\n  WHERE vp.id_vopr IN (SELECT\n        vt.id_vopr\n      FROM mathematical_analysis.voprosi_testov vt\n        JOIN mathematical_analysis.tests ts\n          ON vt.id_tests = ts.id_test\n      WHERE ts.id_temi = OLD.id_temi);\n\n  -- Дополнительно удаляем вопросы, не связанные с тестами\n  DELETE\n    FROM mathematical_analysis.voprosi\n  WHERE id_vopr NOT IN (SELECT\n        id_vopr\n      FROM mathematical_analysis.voprosi_testov);\n\n  -- Удаляем тесты, связанные с удаляемыми темами\n  DELETE\n    FROM mathematical_analysis.tests\n  WHERE id_temi = OLD.id_temi;\n\n  -- Удаляем конспекты лекций и примеров\n  DELETE\n    FROM mathematical_analysis.konspect_lekcii\n  WHERE id_temi = OLD.id_temi;\n\n  DELETE\n    FROM mathematical_analysis.konspetti_primerov\n  WHERE id_temi = OLD.id_temi;\n\n  -- Удаляем записи из \'jyrnal_izychenia\'\n  DELETE\n    FROM mathematical_analysis.jyrnal_izychenia\n  WHERE id_temi = OLD.id_temi;\n    SET @DISABLE_TRIGGER = NULL;\nEND'
sql_modes=1436549152
definers='root@localhost'
client_cs_names='utf8'
connection_cl_names='utf8_general_ci'
db_cl_names='utf8mb4_general_ci'
created=171846945474
