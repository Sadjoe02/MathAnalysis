TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER deleting_section\n	BEFORE DELETE\n	ON razdel\n	FOR EACH ROW\nBEGIN\nSET @DISABLE_TRIGGER = 1;\n  -- Удаляем ошибки, связанные с вопросами и попытками, относящимися к удаляемым тестам и темам\n  DELETE osh\n    FROM mathematical_analysis.oshibki osh\n      INNER JOIN mathematical_analysis.popitki pop\n        ON osh.id_popitka = pop.id_popitka\n      INNER JOIN mathematical_analysis.tests tst\n        ON pop.id_tests = tst.id_test\n      INNER JOIN mathematical_analysis.temi tm\n        ON tst.id_temi = tm.id_temi\n  WHERE tm.id_razdel = OLD.id_razdel;\n\n  -- Удаляем ошибки, связанные с вопросами тестов удаляемой темы\n  DELETE osh\n    FROM mathematical_analysis.oshibki osh\n      INNER JOIN mathematical_analysis.voprosi vp\n        ON osh.id_vopr = vp.id_vopr\n      INNER JOIN mathematical_analysis.voprosi_testov vt\n        ON vp.id_vopr = vt.id_vopr\n      INNER JOIN mathematical_analysis.tests tst\n        ON vt.id_tests = tst.id_test\n      INNER JOIN mathematical_analysis.temi tm\n        ON tst.id_temi = tm.id_temi\n  WHERE tm.id_razdel = OLD.id_razdel;\n\n  -- Удаляем попытки, связанные с тестами, относящимися к удаляемым темам\n  DELETE pop\n    FROM mathematical_analysis.popitki pop\n      INNER JOIN mathematical_analysis.tests tst\n        ON pop.id_tests = tst.id_test\n      INNER JOIN mathematical_analysis.temi tm\n        ON tst.id_temi = tm.id_temi\n  WHERE tm.id_razdel = OLD.id_razdel;\n\n  -- Удаляем записи из таблицы \'otveti\', связанные с вопросами\n  DELETE ot\n    FROM mathematical_analysis.otveti ot\n      INNER JOIN mathematical_analysis.voprosi vp\n        ON ot.id_vopr = vp.id_vopr\n      INNER JOIN mathematical_analysis.voprosi_testov vt\n        ON vp.id_vopr = vt.id_vopr\n      INNER JOIN mathematical_analysis.tests ts\n        ON vt.id_tests = ts.id_test\n      INNER JOIN mathematical_analysis.temi tm\n        ON ts.id_temi = tm.id_temi\n  WHERE tm.id_razdel = OLD.id_razdel;\n\n-- Удаляем связи между тестами и вопросами\n  DELETE vt\n    FROM mathematical_analysis.voprosi_testov vt\n      INNER JOIN mathematical_analysis.tests ts\n        ON vt.id_tests = ts.id_test\n      INNER JOIN mathematical_analysis.temi tm\n        ON ts.id_temi = tm.id_temi\n  WHERE tm.id_razdel = OLD.id_razdel;\n\n  -- Удаляем вопросы, связанные с тестами\n  DELETE vp\n    FROM mathematical_analysis.voprosi vp\n  WHERE vp.id_vopr IN (SELECT\n        vt.id_vopr\n      FROM mathematical_analysis.voprosi_testov vt\n        JOIN mathematical_analysis.tests ts\n          ON vt.id_tests = ts.id_test\n        JOIN mathematical_analysis.temi tm\n          ON ts.id_temi = tm.id_temi\n      WHERE tm.id_razdel = OLD.id_razdel);\n\n  -- Дополнительно удаляем вопросы, не связанные с тестами\n  DELETE\n    FROM mathematical_analysis.voprosi\n  WHERE id_vopr NOT IN (SELECT\n        id_vopr\n      FROM mathematical_analysis.voprosi_testov);\n\n  -- Удаляем тесты, связанные с удаляемыми темами\n  DELETE\n    FROM mathematical_analysis.tests\n  WHERE id_temi IN (SELECT\n        id_temi\n      FROM mathematical_analysis.temi\n      WHERE id_razdel = OLD.id_razdel);\n\n  -- Удаляем конспекты лекций и примеров\n  DELETE\n    FROM mathematical_analysis.konspect_lekcii\n  WHERE id_temi IN (SELECT\n        id_temi\n      FROM mathematical_analysis.temi\n      WHERE id_razdel = OLD.id_razdel);\n\n  DELETE\n    FROM mathematical_analysis.konspetti_primerov\n  WHERE id_temi IN (SELECT\n        id_temi\n      FROM mathematical_analysis.temi\n      WHERE id_razdel = OLD.id_razdel);\n\n  -- Удаляем записи из \'jyrnal_izychenia\'\n  DELETE\n    FROM mathematical_analysis.jyrnal_izychenia\n  WHERE id_temi IN (SELECT\n        id_temi\n      FROM mathematical_analysis.temi\n      WHERE id_razdel = OLD.id_razdel);\n\n  -- Удаляем темы, связанные с удаляемым разделом\n  DELETE\n    FROM mathematical_analysis.temi\n  WHERE id_razdel = OLD.id_razdel;\n  SET @DISABLE_TRIGGER = NULL;\nEND'
sql_modes=1436549152
definers='root@localhost'
client_cs_names='utf8'
connection_cl_names='utf8_general_ci'
db_cl_names='utf8mb4_general_ci'
created=171846938851
